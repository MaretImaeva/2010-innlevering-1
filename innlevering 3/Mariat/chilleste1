
from collections import defaultdict
from itertools import combinations
import heapq 
from Graf1000 import alt_dict, Skuespiller, Film, finn_node
import csv


#actors = "actors.tsv"
#movies = "movies.tsv"


actors = "marvel_actors.tsv"
movies = "marvel_movies.tsv"    


def dijkstra_finn_korteste_sti(graf, id1, id2):
    val = alt_dict.values()
    noder = alt_dict.keys()

    #startnode = finn_node(id1)
    #sluttnode = finn_node(id2)

    if (alt_dict[id1]) is None or (alt_dict[id2]) is None:
        print(f"En av nodene finnes ikke i grafen: {id1} eller {id2}")
        return None, []
    
    #startnode = startnode.navn #bytt til .id om man ønkser å søke med id
    #sluttnode = sluttnode.navn

    avstand = {}
    for key in alt_dict.keys():
        avstand[key] = float('inf')
    avstand[id1] = 0
    forelder = {node: None for node in noder}

    pq = []
    heapq.heappush(pq, (0, id1))
    besøkt = set()

    while pq:
        nåværende_avstand, nåværende_node = heapq.heappop(pq)

        if nåværende_node in besøkt:
            continue
        besøkt.add(nåværende_node)

        if nåværende_node == id2:
            break  # Vi har funnet korteste vei

        #print(type(alt_dict[nåværende_node]), alt_dict[nåværende_node])
        for nabo, tittel, id, vekt in alt_dict[nåværende_node]["kant"]:
            ny_avstand = nåværende_avstand + vekt
            if ny_avstand < avstand[nabo]:
                avstand[nabo] = ny_avstand
                forelder[nabo] = nåværende_node
                heapq.heappush(pq, (ny_avstand, nabo))


    # Rekonstruer korteste sti
    sti = []
    node = id2
    while node is not None:
        sti.append(node)
        node = forelder[node]
    sti.reverse()

    total_weight = 0 

    start_navn = alt_dict[id1]["navn"]
    slutt_navn = alt_dict[id2]["navn"]
    print(f"Sti fra {start_navn} til {slutt_navn}")
    print(alt_dict.get(sti[0], sti[0]))
    for i in range(1, len(sti)):
        a, b = sti[i-1], sti[i]
        if tittel:
            vekt = 10 - float(vekt)  # vektfunksjonen fra oppgaven
            total_weight += vekt
            print(f"===[ {tittel} ({vekt}) ] ===>{alt_dict[b]["navn"]}")
        else:
            print(f"===[ ? ] ===> {alt_dict[b]["navn"]}")

    print("Total weight:", round(total_weight, 2))
    return avstand[id2], sti


#dijkstra_finn_korteste_sti(alt_dict, "Donald Glover","Jeremy Irons")
dijkstra_finn_korteste_sti(alt_dict, "nm2255973", "nm0000460")


